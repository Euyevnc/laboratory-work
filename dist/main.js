!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="./",n(n.s=2)}([function(e,t,n){"use strict";var i;var r={calculate:function(e,t){var n,i,r,a=[];try{n=this.toDecimal(e),i=this.toDecimal(t)}catch(e){return null}if(i<n)return null;for(r=n;r<=i;){var o=this.getOptimalRange(r,i);if(null===o)return null;a.push(o),r=o.ipHigh+1}return a},calculateSubnetMask:function(e,t){var n;try{n=this.toDecimal(e)}catch(e){return null}return this.getMaskRange(n,t)},calculateCIDRPrefix:function(e,t){var n,i,r,a=0,o=0;try{n=this.toDecimal(e),i=this.toDecimal(t)}catch(e){return null}for(r=0;r<32&&(i&(o=a+(1<<32-(r+1))>>>0))>>>0===o;r++)a=o;return this.getMaskRange(n,r)},getOptimalRange:function(e,t){var n,i=null;for(n=32;n>=0;n--){var r=this.getMaskRange(e,n);if(!(r.ipLow===e&&r.ipHigh<=t))break;i=r}return i},getMaskRange:function(e,t){var n=this.getPrefixMask(t),i=this.getMask(32-t),r=(e&n)>>>0,a=((e&n)>>>0)+i>>>0;return{ipLow:r,ipLowStr:this.toString(r),ipHigh:a,ipHighStr:this.toString(a),prefixMask:n,prefixMaskStr:this.toString(n),prefixSize:t,invertedMask:i,invertedMaskStr:this.toString(i),invertedSize:32-t}},getPrefixMask:function(e){var t,n=0;for(t=0;t<e;t++)n+=1<<32-(t+1)>>>0;return n},getMask:function(e){var t,n=0;for(t=0;t<e;t++)n+=1<<t>>>0;return n},isIp:function(e){if("string"!=typeof e)return!1;var t=e.match(/^([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/);if(null===t)return!1;for(var n=1;n<=4;n++){var i=parseInt(t[n],10);if(i>255||i<0)return!1}return!0},isDecimalIp:function(e){return"number"==typeof e&&e%1==0&&e>=0&&e<=4294967295},toDecimal:function(e){if("number"==typeof e&&!0===this.isDecimalIp(e))return e;if(!1===this.isIp(e))throw new Error("Not an IP address: "+e);var t=e.split(".");return 256*(256*(256*+t[0]+ +t[1])+ +t[2])+ +t[3]},toString:function(e){if("string"==typeof e&&!0===this.isIp(e))return e;if(!1===this.isDecimalIp(e))throw new Error("Not a numeric IP address: "+e);for(var t=e%256,n=3;n>0;n--)t=(e=Math.floor(e/256))%256+"."+t;return t}};void 0===(i=function(){return r}.apply(t,[]))||(e.exports=i)},function(e,t,n){},function(e,t,n){"use strict";n.r(t);n(1);function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=function(){function e(t){var n=t.startDevice,r=t.finishDevice;i(this,e),this.startImg=n,this.finishImg=r,this.x,this.y,this.fx,this.fy,this.connectAndSync()}return a(e,[{key:"connectAndSync",value:function(){this.startImg.addLine(this),this.finishImg.addLine(this),this.startImg.x=this.startImg.x,this.startImg.y=this.startImg.y,this.finishImg.x=this.finishImg.x,this.finishImg.y=this.finishImg.y}}]),e}(),c=n(0),l=n.n(c);function u(e,t,n){if(!t)return e==n;var i=l.a.calculateCIDRPrefix(e,t),r=i.ipLowStr.split(".").map((function(e){return Number(e)})),a=i.ipHighStr.split(".").map((function(e){return Number(e)}));console.log("IP адрес сети: ".concat(i.ipLowStr,", Широковещательный адрес: ").concat(i.ipHighStr));var o=!0;return n.split(".").map((function(e){return Number(e)})).forEach((function(e,t){e>=r[t]&&e<=a[t]||(o=!1)})),o}var h=function(){function e(t){var n=this,r=t.image,a=t.canvasObject,s=t.eventData;i(this,e),o(this,"connectionTest",(function(e){var t,i,r,a,o,s,c,l=[],h=function e(t,n){if(l.push(t),t==n)return!0;var i=!1;return t.connectedLines.forEach((function(t){t.isDeprecated||(-1==l.indexOf(t.startImg)?i=e(t.startImg,n)||i:-1==l.indexOf(t.finishImg)&&(i=e(t.finishImg,n)||i))})),i}(n,e),f=(i=e,r=(t=n).mask,a=i.mask,o=t.ip,s=i.ip,c=u(o,r,s),u(s,a,o)&&c);return h&&f})),this.image=r,this.context=a.context,this.type=r.id,this.id=this.type+"#"+(a.imagesToDraw.filter((function(e){return e.type===n.type})).length+1),this.mask,this.gateway,this.ip,this._x=s.clientX-a.root.offsetLeft-s.dataTransfer.getData("mouse_position_x"),this._y=s.clientY-a.root.offsetTop-s.dataTransfer.getData("mouse_position_y"),this.width=r.offsetWidth,this.height=r.offsetHeight,this.connectedLines=[]}return a(e,[{key:"addLine",value:function(e){this.connectedLines.push(e)}},{key:"x",get:function(){return this._x},set:function(e){var t=this;this._x=e,this.connectedLines.forEach((function(n,i){n.startImg==t?n.x="hub"==t.type?e+t.width/2-11+11*i:"rout"==t.type?e+t.width/2-33+13*i:e+t.width/2:n.finishImg==t&&(n.fx="hub"==t.type?e+t.width/2-11+11*i:"rout"==t.type?e+t.width/2-33+13*i:e+t.width/2)}))}},{key:"y",get:function(){return this._y},set:function(e){var t=this;this._y=e,this.connectedLines.forEach((function(n){n.startImg==t?n.y="pc"!==t.type?e+t.height/1.4-3:e+t.height/2:n.finishImg==t&&(n.fy="pc"!==t.type?e+t.height/1.4-3:e+t.height/2)}))}}]),e}();function f(e,t,n){return!(e<n.x||e>n.x+n.width||t<n.y||t>n.y+n.height)}function d(e){console.warn(e);var t=document.querySelector(".error");t.textContent=e,t.style.display="inline-block",t.classList.add("active"),setTimeout(v,2e3)}function v(){var e=document.querySelector(".error");e.classList.remove("active"),setTimeout((function(){e.textContent="",e.style.display="none"}),1e3)}var g=function(){function e(t){var n=this;i(this,e),o(this,"handlerCanvasDrop",(function(e){e.preventDefault();var t=document.getElementById(e.dataTransfer.getData("image_id"));n.createImage({image:t,canvasObject:n,eventData:e})})),o(this,"handlerCanvasDoubleClick",(function(e){for(var t=e.offsetX,i=e.offsetY,r=0,a=n.imagesToDraw.length;r<a;r++){var o=n.imagesToDraw[r];f(t,i,o)&&"pc"===o.type&&(n.selectedDevice=o)}n.renderScene()})),o(this,"handlerCanvasMousedown",(function(e){for(var t=e.offsetX,i=e.offsetY,r=0,a=n.imagesToDraw.length;r<a;r++){var o=n.imagesToDraw[r];if(f(t,i,o)){n.handlerCanvasMove(o,t,i);break}}})),this.root=document.getElementById(t),this.context=this.root.getContext("2d"),this.imagesToDraw=[],this.linesToDraw=[],this.selectedDevice,this.root.addEventListener("drop",this.handlerCanvasDrop),this.root.addEventListener("dblclick",this.handlerCanvasDoubleClick),this.root.addEventListener("mousedown",this.handlerCanvasMousedown),this.root.addEventListener("dragover",(function(e){return e.preventDefault()}))}return a(e,[{key:"handlerCanvasMove",value:function(e,t,n){var i=this,r=this.root,a=e.x,o=e.y;r.onmousemove=function(r){var s=r.offsetX,c=r.offsetY,l=s-t,u=c-n;e.x=a+l,e.y=o+u,i.renderScene()},r.onmouseup=function(){r.onmousemove=null,r.onmouseup=null}}},{key:"createLine",value:function(e,t){var n=new s({startDevice:e,finishDevice:t});this.linesToDraw.push(n),this.renderScene()}},{key:"deleteLine",value:function(e,t){var n=this,i=!1;e.connectedLines.forEach((function(r){i||r.startImg!==t&&r.finishImg!==t||(i=!0,e.connectedLines.splice(e.connectedLines.indexOf(r),1),t.connectedLines.splice(t.connectedLines.indexOf(r),1),n.linesToDraw.splice(n.linesToDraw.indexOf(r),1))})),i?this.renderScene():d("Нет общих соединений!")}},{key:"createImage",value:function(e){var t=new h(e);this.imagesToDraw.push(t),this.renderScene()}},{key:"renderScene",value:function(){var e=this.root,t=this.context,n=this.imagesToDraw,i=this.linesToDraw;if(t.clearRect(0,0,e.width,e.height),n.length)for(var r=0,a=n.length;r<a;r++){var o=n[r];"pc"!=o.type&&(o.ip&&(t.font="15px Electrolize, Arial, sans-serif",t.textAlign="center",t.fillStyle="black",t.fillText(o.ip,o.x+64,o.y+128)),t.drawImage(o.image,o.x,o.y))}if(i.length)for(var s=0,c=i.length;s<c;s++){var l=i[s];t.beginPath(),t.moveTo(l.fx,l.fy),t.lineTo(l.x,l.y),t.strokeStyle="#212121",t.lineWidth=5,t.lineJoin=t.lineCap="round",t.stroke()}if(n.length)for(var u=0,h=n.length;u<h;u++){var f=n[u];"pc"===f.type&&(this.selectedDevice===f&&(t.beginPath(),t.arc(f.x+f.width/2,f.y+60,64,0,2*Math.PI),t.fillStyle="#009900",t.fill()),f.ip&&(t.font="15px Electrolize, Arial, sans-serif",t.textAlign="center",t.fillStyle="black",t.fillText(f.ip,f.x+64,f.y+140)),t.drawImage(f.image,f.x,f.y))}}}]),e}(),m=function e(t,n){var r=this;i(this,e),o(this,"handlerConnectorClick",(function(){r.canvas.addEventListener("click",r.handlerImageFirstSelect),r.image.removeEventListener("click",r.handlerConnectorClick),r.canvas.style.cursor="cell",r.image.style.opacity="0.2",setTimeout((function(){document.addEventListener("click",r.handlerDocClick),r.canvas.style.cursor="cell",r.image.style.opacity="0.2"}),100)})),o(this,"handlerImageFirstSelect",(function(e){for(var t=r.canvasObject.imagesToDraw,n=e.offsetX,i=e.offsetY,a=0,o=t.length;a<o;a++){var s=t[a];if(f(n,i,s)){if(s.connectedLines.length>=5){d("Максимальное число подключений у этого устройства достигнуто!");break}r.currentConnecting.startDevice=s,r.canvas.removeEventListener("click",r.handlerImageFirstSelect),r.canvas.addEventListener("click",r.handlerImageSecondSelect);break}}})),o(this,"handlerImageSecondSelect",(function(e){for(var t=r.canvasObject.imagesToDraw,n=e.offsetX,i=e.offsetY,a=0,o=t.length;a<o;a++){var s=t[a];if(f(n,i,s)){if(s==r.currentConnecting.startDevice){d("Начальная и конечная точка соединения совпадают!");break}if(s.connectedLines.length>=5){d("Максимальное число подключений у этого устройства достигнуто!");break}r.currentConnecting.finishDevice=s,r.canvasObject.createLine(r.currentConnecting.startDevice,r.currentConnecting.finishDevice),r.complete();break}}})),o(this,"handlerDocClick",(function(e){e.target!==r.canvas&&r.complete()})),o(this,"complete",(function(){document.removeEventListener("click",r.handlerDocClick),r.canvas.removeEventListener("click",r.handlerImageFirstSelect),r.canvas.removeEventListener("click",r.handlerImageSecondSelect),r.currentConnecting={},r.image.addEventListener("click",r.handlerConnectorClick),r.canvas.style.cursor="auto",r.image.style.opacity="1"})),this.image=document.getElementById(t),this.canvasObject=n,this.canvas=n.root,this.currentConnecting={},this.image.addEventListener("click",this.handlerConnectorClick)},p=function e(t,n){var r=this;i(this,e),o(this,"handlerBreakerClick",(function(){r.canvas.addEventListener("click",r.handlerImageFirstSelect),r.image.removeEventListener("click",r.handlerBreakerClick),setTimeout((function(){document.addEventListener("click",r.handlerDocClick),r.canvas.style.cursor="cell",r.image.style.opacity="0.2"}),100)})),o(this,"handlerDocClick",(function(e){e.target!==r.canvas&&r.complete()})),o(this,"handlerImageFirstSelect",(function(e){for(var t=r.canvasObject.imagesToDraw,n=e.offsetX,i=e.offsetY,a=0,o=t.length;a<o;a++){var s=t[a];if(f(n,i,s)){if(!s.connectedLines.length){d("Не имеет подключений, которые можно разорвать!");break}r.currentBreaking.firstDevice=s,r.canvas.removeEventListener("click",r.handlerImageFirstSelect),r.canvas.addEventListener("click",r.handlerImageSecondSelect);break}}})),o(this,"handlerImageSecondSelect",(function(e){for(var t=r.canvasObject.imagesToDraw,n=e.offsetX,i=e.offsetY,a=0,o=t.length;a<o;a++){var s=t[a];if(f(n,i,s)){if(!s.connectedLines.length){d("Не имеет подключений, которые можно разорвать!");break}if(s===r.currentBreaking.firstDevice){d("Начальная и конечная точка разрыва соединения совпадают!");break}r.currentBreaking.secondDevice=s,r.canvasObject.deleteLine(r.currentBreaking.firstDevice,r.currentBreaking.secondDevice),r.complete();break}}})),o(this,"complete",(function(){document.removeEventListener("click",r.handlerDocClick),r.canvas.removeEventListener("click",r.handlerImageFirstSelect),r.canvas.removeEventListener("click",r.handlerImageSecondSelect),r.currentBreaking={},r.image.addEventListener("click",r.handlerBreakerClick),r.canvas.style.cursor="auto",r.image.style.opacity="1"})),this.image=document.getElementById(t),this.canvasObject=n,this.canvas=n.root,this.currentBreaking={},this.image.addEventListener("click",this.handlerBreakerClick)},y=function e(t,n){var r=this;i(this,e),o(this,"displayDispatcher",(function(e){r.processingDevice=e,r.root.style.display="block",r.label.textContent="".concat(e.id),r.maskField.value=e.mask||"",r.gateway.value=e.gateway||"",r.ipField.value=e.ip||""})),o(this,"saveData",(function(e){e.mask=r.maskField.value,e.gateway=r.gateway.value,e.ip=r.ipField.value})),o(this,"handlerButtonClick",(function(e,t){r.saveData(t),r.root.style.display="none",r.processingDevice=void 0,r.canvasObject.renderScene()})),o(this,"handlerCloseClick",(function(){r.root.style.display="none",r.processingDevice=void 0})),o(this,"handleCanvasContext",(function(e){e.preventDefault();for(var t=r.canvasObject.imagesToDraw,n=e.offsetX,i=e.offsetY,a=0,o=t.length;a<o;a++){var s=t[a];if(f(n,i,s)){if("hub"===s.type)break;"rout"===s.type&&d("under constraction"),"pc"===s.type&&r.displayDispatcher(s)}}})),this.root=document.getElementById(t),this.canvasObject=n,this.processingDevice,this.maskField=document.getElementById("mask"),this.ipField=document.getElementById("ip"),this.gateway=document.getElementById("schleuse"),this.label=this.root.querySelector(".label"),this.close=this.root.querySelector(".close"),this.confirmButton=this.root.querySelector(".button"),this.close.addEventListener("click",this.handlerCloseClick),this.confirmButton.addEventListener("click",(function(e){r.handlerButtonClick(e,r.processingDevice)})),this.canvasObject.root.addEventListener("contextmenu",this.handleCanvasContext)};function k(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,function(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}(e,t,"get"))}var w=new WeakMap,b=new WeakMap,D=new WeakMap,L=new WeakMap,I=function e(t,n){var r=this;i(this,e),w.set(this,{writable:!0,value:function(e){var t=e.target.value,n=t.replaceAll(/\n>/g,"\n"),i=n.split("\n");if(i.length>1){var r=i.pop();n=(n=i.join("\n")+"\n>"+r).replace(/^\>/,""),e.target.value=n}}}),b.set(this,{writable:!0,value:function(e){if("Enter"===e.key){var t=e.target.value,n=t.lastIndexOf("\n>")||0,i=t.substring(n+2),a=k(r,D).call(r,i),o=k(r,L).call(r,i);if("ping"===a){var s=r.canvasObject.selectedDevice,c=r.canvasObject.imagesToDraw.filter((function(e){return e.ip===o}))[0];if(s)if(c)if(s!==c)if("pc"===c.type){var l=s.connectionTest(c);e.target.value+=l?"\nОтвет от ".concat(c.ip,": число байт = 32, время = ").concat(20+Math.round(40*Math.random())," мс, TTL = 53.\nСтатистика ping для ").concat(c.ip,":\nПакетов отправлено: 1, получено: 1, потеряно 0 (0% потерь).\nПриблизительное время приёма/передачи в мс: ").concat(20+Math.round(30*Math.random())):"\nПри проверке связи не удалось обнаружить узел ".concat(c.ip,". \nПроверьте имя узла и повторите попытку.")}else e.target.value+="\nOutput point is incorrect";else e.target.value+="\nEntry and output points are the same";else e.target.value+="\nNo output point ";else e.target.value+="\nNo entry point "}else e.target.value+="\n unknown command"}}}),D.set(this,{writable:!0,value:function(e){var t=e.match(/\b\w*\b/);return t?t[0]:null}}),L.set(this,{writable:!0,value:function(e){var t=e.match(/(\d+\.){3}\d+/);return t?t[0]:null}}),this.root=document.getElementById(t),this.canvasObject=n,this.root.addEventListener("input",k(this,w)),this.root.addEventListener("keydown",k(this,b))};document.addEventListener("DOMContentLoaded",(function(){var e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.requestAnimationFrame=e;var t=new g("canvas");new m("connector",t),new p("linebreaker",t),new y("menu",t),new I("cmd",t);function n(e){e.dataTransfer.setData("mouse_position_x",e.clientX-e.target.offsetLeft),e.dataTransfer.setData("mouse_position_y",e.clientY-e.target.offsetTop),e.dataTransfer.setData("image_id",e.target.id)}document.querySelectorAll(".panel-for-icons img").forEach((function(e){"connector"===e.id||"linebreaker"===e.id?e.addEventListener("dragstart",(function(e){return e.preventDefault()})):e.addEventListener("dragstart",n)}))}))}]);